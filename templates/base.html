<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HookWise - Webhook Router</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/logo.png') }}">
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/prism.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>

<body>
    <div id="loading-bar" style="width: 0%;"></div>
    {% if request.endpoint != 'main.login' %}
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('main.index') }}">
                <div class="hw-logo-container me-2">
                    <svg class="logo-8bit-svg" viewBox="0 0 320 80" xmlns="http://www.w3.org/2000/svg">
                        <rect class="retro-scanline" x="0" y="0" width="320" height="2" />
                        <g class="falling-garbage">
                            <text x="50" y="-20" class="falling-piece" fill="var(--retro-white)"
                                font-family="'Courier New', monospace" font-size="20">a</text>
                            <text x="120" y="-40" class="falling-piece" style="animation-delay: 0.2s"
                                fill="var(--retro-cyan)" font-family="'Courier New', monospace" font-size="24">f</text>
                            <text x="200" y="-10" class="falling-piece" style="animation-delay: 0.5s"
                                fill="var(--retro-magenta)" font-family="'Courier New', monospace"
                                font-size="18">x</text>
                            <text x="280" y="-30" class="falling-piece" style="animation-delay: 0.8s"
                                fill="var(--retro-yellow)" font-family="'Courier New', monospace"
                                font-size="22">p</text>
                        </g>

                        <g class="word-group tugged logo-settled" transform="translate(40, 45)">
                            <path class="retro-letter snap-letter" style="animation-delay: 2.2s"
                                fill="var(--retro-cyan)" d="M0 0 V30 M0 15 H15 V30" stroke="var(--retro-cyan)"
                                stroke-width="8" />
                            <rect class="retro-letter snap-letter" style="animation-delay: 2.4s" x="25" y="10"
                                width="20" height="20" fill="none" stroke="var(--retro-white)" stroke-width="6" />
                            <rect class="retro-letter snap-letter" style="animation-delay: 2.6s" x="55" y="10"
                                width="20" height="20" fill="none" stroke="var(--retro-white)" stroke-width="6" />
                            <path class="retro-letter snap-letter" style="animation-delay: 2.8s" fill="none"
                                stroke="var(--retro-cyan)" stroke-width="8"
                                d="M85 0 V30 M85 15 L105 0 M85 15 L105 30" />
                            <path class="retro-letter snap-letter w-bounce" style="animation-delay: 3.0s" fill="none"
                                stroke="var(--retro-white)" stroke-width="8" d="M115 10 V30 L 125 20 L 135 30 V 10" />
                            <rect class="retro-letter snap-letter" style="animation-delay: 3.2s" x="145" y="10"
                                width="8" height="20" fill="var(--retro-cyan)" />
                            <rect class="i-dot-fall" x="145" y="0" width="8" height="6" fill="var(--retro-yellow)" />
                            <path class="retro-letter snap-letter" style="animation-delay: 3.4s" fill="none"
                                stroke="var(--retro-magenta)" stroke-width="6" d="M165 10 H185 V20 H165 V30 H185" />
                            <path class="retro-letter snap-letter" style="animation-delay: 3.6s" fill="none"
                                stroke="var(--retro-white)" stroke-width="6" d="M195 10 H215 V30 H195 M195 20 H215" />

                            <rect class="sparkle" style="animation-delay: 2.2s" x="-5" y="15" width="4" height="4"
                                fill="var(--retro-yellow)" />
                            <rect class="sparkle" style="animation-delay: 3.0s" x="120" y="25" width="4" height="4"
                                fill="var(--retro-cyan)" />
                        </g>

                        <g class="retro-hook" transform="translate(260, 45)">
                            <path d="M0 -30 V10 C0 30 30 30 30 10 L 25 15" fill="none" stroke="var(--retro-white)"
                                stroke-width="6" />
                            <rect x="25" y="5" width="8" height="8" fill="var(--retro-yellow)" />
                        </g>

                        <g font-family="'Courier New', monospace" font-weight="bold" font-size="10"
                            transform="translate(40, 75)">
                            <text x="0" y="0" class="tagline-char" style="animation-delay: 8.0s"
                                fill="var(--retro-white)">H</text>
                            <text x="8" y="0" class="tagline-char" style="animation-delay: 8.1s"
                                fill="var(--retro-white)">O</text>
                            <text x="16" y="0" class="tagline-char" style="animation-delay: 8.2s"
                                fill="var(--retro-white)">O</text>
                            <text x="24" y="0" class="tagline-char" style="animation-delay: 8.3s"
                                fill="var(--retro-white)">K</text>
                            <text x="36" y="0" class="tagline-char" style="animation-delay: 8.5s"
                                fill="var(--retro-cyan)">L</text>
                            <text x="44" y="0" class="tagline-char" style="animation-delay: 8.6s"
                                fill="var(--retro-cyan)">I</text>
                            <text x="52" y="0" class="tagline-char" style="animation-delay: 8.7s"
                                fill="var(--retro-cyan)">N</text>
                            <text x="60" y="0" class="tagline-char" style="animation-delay: 8.8s"
                                fill="var(--retro-cyan)">E</text>
                            <text x="72" y="0" class="tagline-char" style="animation-delay: 9.0s"
                                fill="var(--retro-white)">C</text>
                            <text x="80" y="0" class="tagline-char" style="animation-delay: 9.1s"
                                fill="var(--retro-white)">O</text>
                            <text x="88" y="0" class="tagline-char" style="animation-delay: 9.2s"
                                fill="var(--retro-white)">N</text>
                            <text x="96" y="0" class="tagline-char" style="animation-delay: 9.3s"
                                fill="var(--retro-white)">N</text>
                            <text x="104" y="0" class="tagline-char" style="animation-delay: 9.4s"
                                fill="var(--retro-white)">E</text>
                            <text x="112" y="0" class="tagline-char" style="animation-delay: 9.5s"
                                fill="var(--retro-white)">C</text>
                            <text x="120" y="0" class="tagline-char" style="animation-delay: 9.6s"
                                fill="var(--retro-white)">T</text>
                        </g>
                    </svg>
                </div>
                HookWise
            </a>
            <div class="navbar-nav ms-auto">
                {% if session.user_id %}
                <span class="nav-link small text-muted me-2">Hi, {{ session.username }}</span>
                <a class="nav-link" href="{{ url_for('main.index') }}">Endpoints</a>
                <a class="nav-link" href="{{ url_for('main.history') }}">History</a>
                <a class="nav-link" href="{{ url_for('main.audit_logs') }}">Audit</a>
                <a class="nav-link" href="{{ url_for('main.settings') }}">Settings</a>
                <a class="nav-link" href="{{ url_for('main.logout') }}">Logout</a>
                {% else %}
                <!-- Login removed from navbar as all pages are protected -->
                {% endif %}
                <a class="nav-link" href="#" data-bs-toggle="offcanvas" data-bs-target="#docsSidebar">Docs</a>
                <a class="nav-link" href="{{ url_for('main.new_endpoint') }}">New Endpoint</a>
            </div>
        </div>
    </nav>
    {% endif %}

    <!-- Documentation Sidebar -->
    <div class="offcanvas offcanvas-end bg-dark text-white border-start border-secondary border-opacity-25"
        tabindex="-1" id="docsSidebar" style="width: 400px;">
        <div class="offcanvas-header border-bottom border-secondary border-opacity-10">
            <h5 class="offcanvas-title fw-bold text-primary">Documentation</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <h6 class="fw-bold text-info mb-3">Getting Started</h6>
            <p class="small text-secondary">To start routing alerts, create an endpoint and use the generated URL in
                your monitoring tool (e.g. Uptime Kuma).</p>

            <h6 class="fw-bold text-info mt-4 mb-3">Authentication</h6>
            <p class="small text-secondary">Every request must include the
                <code>Authorization: Bearer &lt;token&gt;</code> header.
            </p>

            <h6 class="fw-bold text-info mt-4 mb-3">Smart Parsing</h6>
            <p class="small text-secondary">Include <code>#CW&lt;CompanyIdentifier&gt;</code> in your alert title to
                automatically route to a specific client.</p>

            <h6 class="fw-bold text-info mt-4 mb-3">JSONPath Mappings</h6>
            <p class="small text-secondary">Use dot notation (e.g. <code>$.monitor.status</code>) to map payload fields
                to ticket fields.</p>

            <hr class="my-4 border-secondary border-opacity-10">
            <div class="alert alert-info bg-opacity-10 border-info border-opacity-25 py-2">
                <p class="mb-0 small text-info">Need more help? Check the <a href="https://github.com/hookwise/hookwise"
                        target="_blank" class="fw-bold">GitHub Repository</a>.</p>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <div class="container pb-5">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <!-- Feedback Removed -->

    <button id="back-to-top" class="btn btn-primary position-fixed bottom-0 end-0 m-4 rounded-circle shadow-lg d-none"
        style="z-index: 1050; width: 45px; height: 45px;" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-up"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
                d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z" />
        </svg>
    </button>

    {% if request.endpoint != 'main.login' %}
    <footer class="footer mt-auto py-3 bg-dark bg-opacity-50 border-top border-secondary border-opacity-10">
        <div class="container d-flex justify-content-between align-items-center">
            <span class="text-secondary small">&copy; 2026 HookWise</span>
            <div class="health-indicators">
                <span class="text-secondary small me-3">
                    <span id="health-redis" class="heartbeat-dot heartbeat-warning"></span> Redis
                </span>
                <span class="text-secondary small me-3">
                    <span id="health-database" class="heartbeat-dot heartbeat-warning"></span> DB
                </span>
                <span class="text-secondary small">
                    <span id="health-celery" class="heartbeat-dot heartbeat-warning"></span> Celery
                </span>
            </div>
        </div>
    </footer>
    {% endif %}

    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/socket.io.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/prism.js') }}"></script>
    <script src="{{ url_for('static', filename='js/mini-charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ux.js') }}"></script>
</body>

</html>