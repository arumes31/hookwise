<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HookWise - Webhook Router</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/logo.png') }}">
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/prism.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>

<body>
    <div id="loading-bar" style="width: 0%;"></div>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('main.index') }}">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="HookWise" height="42"
                    class="d-inline-block align-top me-2">
                HookWise
            </a>
            <div class="navbar-nav ms-auto">
                {% if session.user_id %}
                <span class="nav-link small text-muted me-2">Hi, {{ session.username }}</span>
                <a class="nav-link" href="{{ url_for('main.index') }}">Endpoints</a>
                <a class="nav-link" href="{{ url_for('main.history') }}">History</a>
                <a class="nav-link" href="{{ url_for('main.audit_logs') }}">Audit</a>
                <a class="nav-link" href="{{ url_for('main.settings') }}">Settings</a>
                <a class="nav-link" href="{{ url_for('main.logout') }}">Logout</a>
                {% else %}
                <a class="nav-link" href="{{ url_for('main.login') }}">Login</a>
                {% endif %}
                <a class="nav-link" href="#" data-bs-toggle="offcanvas" data-bs-target="#docsSidebar">Docs</a>
                <a class="nav-link" href="{{ url_for('main.new_endpoint') }}">New Endpoint</a>
            </div>
        </div>
    </nav>

    <!-- Documentation Sidebar -->
    <div class="offcanvas offcanvas-end bg-dark text-white border-start border-secondary border-opacity-25"
        tabindex="-1" id="docsSidebar" style="width: 400px;">
        <div class="offcanvas-header border-bottom border-secondary border-opacity-10">
            <h5 class="offcanvas-title fw-bold text-primary">Documentation</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <h6 class="fw-bold text-info mb-3">Getting Started</h6>
            <p class="small text-secondary">To start routing alerts, create an endpoint and use the generated URL in
                your monitoring tool (e.g. Uptime Kuma).</p>

            <h6 class="fw-bold text-info mt-4 mb-3">Authentication</h6>
            <p class="small text-secondary">Every request must include the
                <code>Authorization: Bearer &lt;token&gt;</code> header.</p>

            <h6 class="fw-bold text-info mt-4 mb-3">Smart Parsing</h6>
            <p class="small text-secondary">Include <code>#CW&lt;CompanyIdentifier&gt;</code> in your alert title to
                automatically route to a specific client.</p>

            <h6 class="fw-bold text-info mt-4 mb-3">JSONPath Mappings</h6>
            <p class="small text-secondary">Use dot notation (e.g. <code>$.monitor.status</code>) to map payload fields
                to ticket fields.</p>

            <hr class="my-4 border-secondary border-opacity-10">
            <div class="alert alert-info bg-opacity-10 border-info border-opacity-25 py-2">
                <p class="mb-0 small text-info">Need more help? Check the <a href="https://github.com/hookwise/hookwise"
                        target="_blank" class="fw-bold">GitHub Repository</a>.</p>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <div class="container pb-5">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <button id="feedback-button" class="btn btn-outline-info position-fixed bottom-0 start-0 m-4 rounded-pill shadow-lg"
        style="z-index: 1050;" data-bs-toggle="modal" data-bs-target="#feedbackModal">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-chat-left-text me-2" viewBox="0 0 16 16">
            <path
                d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
            <path
                d="M5 4h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1zm0 2h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1zm0 2h3a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1z" />
        </svg>
        Feedback
    </button>

    <!-- Feedback Modal -->
    <div class="modal fade" id="feedbackModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark border-info">
                <div class="modal-header border-info border-opacity-25">
                    <h5 class="modal-title text-info">Send Feedback</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="feedback-form">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label small fw-bold">MESSAGE</label>
                            <textarea class="form-control" name="message" rows="4"
                                placeholder="Report a bug or suggest an improvement..." required></textarea>
                        </div>
                        <p class="small text-secondary mb-0">Your system info (browser, OS) will be sent to help us
                            debug.</p>
                    </div>
                    <div class="modal-footer border-info border-opacity-25">
                        <button type="button" class="btn btn-sm btn-outline-secondary"
                            data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-sm btn-info text-dark fw-bold">Submit Feedback</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <button id="back-to-top" class="btn btn-primary position-fixed bottom-0 end-0 m-4 rounded-circle shadow-lg d-none"
        style="z-index: 1050; width: 45px; height: 45px;" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-up"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
                d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z" />
        </svg>
    </button>

    <footer class="footer mt-auto py-3 bg-dark bg-opacity-50 border-top border-secondary border-opacity-10">
        <div class="container d-flex justify-content-between align-items-center">
            <span class="text-secondary small">&copy; 2026 HookWise</span>
            <div class="health-indicators">
                <span class="text-secondary small me-3">
                    <span id="health-redis" class="heartbeat-dot heartbeat-warning"></span> Redis
                </span>
                <span class="text-secondary small me-3">
                    <span id="health-database" class="heartbeat-dot heartbeat-warning"></span> DB
                </span>
                <span class="text-secondary small">
                    <span id="health-celery" class="heartbeat-dot heartbeat-warning"></span> Celery
                </span>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/socket.io.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/prism.js') }}"></script>
    <script src="{{ url_for('static', filename='js/mini-charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ux.js') }}"></script>
</body>

</html>