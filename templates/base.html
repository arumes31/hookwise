<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HookWise - Webhook Router</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/logo.png') }}">
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/prism.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>

<body>
    <div id="loading-bar" style="width: 0%;"></div>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('main.index') }}">
                <div class="hw-logo-container me-2">
                    <svg class="logo-animated-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <!-- BG Circuitry -->
                        <path class="logo-circuit-bg"
                            d="M 10 10 L 90 10 L 90 90 L 10 90 Z M 30 30 L 70 30 L 70 70 L 30 70 Z" />
                        <!-- Main Hook Trace -->
                        <path class="logo-hook-trace" d="M 20 40 C 20 10, 80 10, 80 40 C 80 70, 40 70, 40 50 L 40 90" />
                        <!-- Data Streams (Video Effect) -->
                        <path class="logo-stream stream-1"
                            d="M 20 40 C 20 10, 80 10, 80 40 C 80 70, 40 70, 40 50 L 40 90" />
                        <path class="logo-stream stream-2"
                            d="M 20 40 C 20 10, 80 10, 80 40 C 80 70, 40 70, 40 50 L 40 90" />
                        <path class="logo-stream stream-3"
                            d="M 20 40 C 20 10, 80 10, 80 40 C 80 70, 40 70, 40 50 L 40 90" />
                        <!-- Animated Terminal Nodes -->
                        <circle cx="20" cy="40" r="4" class="logo-node" />
                        <circle cx="40" cy="90" r="5" class="logo-node node-accent" />
                    </svg>
                </div>
                HookWise
            </a>
            <div class="navbar-nav ms-auto">
                {% if session.user_id %}
                <span class="nav-link small text-muted me-2">Hi, {{ session.username }}</span>
                <a class="nav-link" href="{{ url_for('main.index') }}">Endpoints</a>
                <a class="nav-link" href="{{ url_for('main.history') }}">History</a>
                <a class="nav-link" href="{{ url_for('main.audit_logs') }}">Audit</a>
                <a class="nav-link" href="{{ url_for('main.settings') }}">Settings</a>
                <a class="nav-link" href="{{ url_for('main.logout') }}">Logout</a>
                {% else %}
                <!-- Login removed from navbar as all pages are protected -->
                {% endif %}
                <a class="nav-link" href="#" data-bs-toggle="offcanvas" data-bs-target="#docsSidebar">Docs</a>
                <a class="nav-link" href="{{ url_for('main.new_endpoint') }}">New Endpoint</a>
            </div>
        </div>
    </nav>

    <!-- Documentation Sidebar -->
    <div class="offcanvas offcanvas-end bg-dark text-white border-start border-secondary border-opacity-25"
        tabindex="-1" id="docsSidebar" style="width: 400px;">
        <div class="offcanvas-header border-bottom border-secondary border-opacity-10">
            <h5 class="offcanvas-title fw-bold text-primary">Documentation</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <h6 class="fw-bold text-info mb-3">Getting Started</h6>
            <p class="small text-secondary">To start routing alerts, create an endpoint and use the generated URL in
                your monitoring tool (e.g. Uptime Kuma).</p>

            <h6 class="fw-bold text-info mt-4 mb-3">Authentication</h6>
            <p class="small text-secondary">Every request must include the
                <code>Authorization: Bearer &lt;token&gt;</code> header.
            </p>

            <h6 class="fw-bold text-info mt-4 mb-3">Smart Parsing</h6>
            <p class="small text-secondary">Include <code>#CW&lt;CompanyIdentifier&gt;</code> in your alert title to
                automatically route to a specific client.</p>

            <h6 class="fw-bold text-info mt-4 mb-3">JSONPath Mappings</h6>
            <p class="small text-secondary">Use dot notation (e.g. <code>$.monitor.status</code>) to map payload fields
                to ticket fields.</p>

            <hr class="my-4 border-secondary border-opacity-10">
            <div class="alert alert-info bg-opacity-10 border-info border-opacity-25 py-2">
                <p class="mb-0 small text-info">Need more help? Check the <a href="https://github.com/hookwise/hookwise"
                        target="_blank" class="fw-bold">GitHub Repository</a>.</p>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <div class="container pb-5">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <!-- Feedback Removed -->

    <button id="back-to-top" class="btn btn-primary position-fixed bottom-0 end-0 m-4 rounded-circle shadow-lg d-none"
        style="z-index: 1050; width: 45px; height: 45px;" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-up"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
                d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z" />
        </svg>
    </button>

    <footer class="footer mt-auto py-3 bg-dark bg-opacity-50 border-top border-secondary border-opacity-10">
        <div class="container d-flex justify-content-between align-items-center">
            <span class="text-secondary small">&copy; 2026 HookWise</span>
            <div class="health-indicators">
                <span class="text-secondary small me-3">
                    <span id="health-redis" class="heartbeat-dot heartbeat-warning"></span> Redis
                </span>
                <span class="text-secondary small me-3">
                    <span id="health-database" class="heartbeat-dot heartbeat-warning"></span> DB
                </span>
                <span class="text-secondary small">
                    <span id="health-celery" class="heartbeat-dot heartbeat-warning"></span> Celery
                </span>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/socket.io.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/prism.js') }}"></script>
    <script src="{{ url_for('static', filename='js/mini-charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ux.js') }}"></script>
</body>

</html>