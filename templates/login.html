{% extends 'base.html' %}

{% block content %}
<canvas id="bg-animation"></canvas>

<div class="row justify-content-center align-items-center" style="min-height: 100vh; overflow-x: hidden; margin: 0;">
    <div class="col-md-5 col-lg-4">
        <div class="glass-card shadow-premium p-4 p-md-5">
            <div class="text-center mb-4">
                <div class="hw-logo-container justify-content-center mb-3">
                    <svg class="logo-8bit-svg" style="height: 100px;" viewBox="0 0 320 80"
                        xmlns="http://www.w3.org/2000/svg">
                        <rect class="retro-scanline" x="0" y="0" width="320" height="2" />
                        <g class="falling-garbage">
                            <text x="50" y="-20" class="falling-piece" fill="var(--retro-white)"
                                font-family="'Courier New', monospace" font-size="20">a</text>
                            <text x="120" y="-40" class="falling-piece" style="animation-delay: 0.2s"
                                fill="var(--retro-cyan)" font-family="'Courier New', monospace" font-size="24">f</text>
                            <text x="200" y="-10" class="falling-piece" style="animation-delay: 0.5s"
                                fill="var(--retro-magenta)" font-family="'Courier New', monospace"
                                font-size="18">x</text>
                            <text x="280" y="-30" class="falling-piece" style="animation-delay: 0.8s"
                                fill="var(--retro-yellow)" font-family="'Courier New', monospace"
                                font-size="22">p</text>
                        </g>

                        <g class="word-group tugged logo-settled" transform="translate(40, 45)">
                            <path class="retro-letter snap-letter" style="animation-delay: 2.2s"
                                fill="var(--retro-cyan)" d="M0 0 V30 M0 15 H15 V30" stroke="var(--retro-cyan)"
                                stroke-width="8" />
                            <rect class="retro-letter snap-letter" style="animation-delay: 2.4s" x="25" y="10"
                                width="20" height="20" fill="none" stroke="var(--retro-white)" stroke-width="6" />
                            <rect class="retro-letter snap-letter" style="animation-delay: 2.6s" x="55" y="10"
                                width="20" height="20" fill="none" stroke="var(--retro-white)" stroke-width="6" />
                            <path class="retro-letter snap-letter" style="animation-delay: 2.8s" fill="none"
                                stroke="var(--retro-cyan)" stroke-width="8"
                                d="M85 0 V30 M85 15 L105 0 M85 15 L105 30" />
                            <path class="retro-letter snap-letter w-bounce" style="animation-delay: 3.0s" fill="none"
                                stroke="var(--retro-white)" stroke-width="8" d="M115 10 V30 L 125 20 L 135 30 V 10" />
                            <rect class="retro-letter snap-letter" style="animation-delay: 3.2s" x="145" y="10"
                                width="8" height="20" fill="var(--retro-cyan)" />
                            <rect class="i-dot-fall" x="145" y="0" width="8" height="6" fill="var(--retro-yellow)" />
                            <path class="retro-letter snap-letter" style="animation-delay: 3.4s" fill="none"
                                stroke="var(--retro-magenta)" stroke-width="6" d="M165 10 H185 V20 H165 V30 H185" />
                            <path class="retro-letter snap-letter" style="animation-delay: 3.6s" fill="none"
                                stroke="var(--retro-white)" stroke-width="6" d="M195 10 H215 V30 H195 M195 20 H215" />

                            <rect class="sparkle" style="animation-delay: 2.2s" x="-5" y="15" width="4" height="4"
                                fill="var(--retro-yellow)" />
                            <rect class="sparkle" style="animation-delay: 3.0s" x="120" y="25" width="4" height="4"
                                fill="var(--retro-cyan)" />
                        </g>

                        <g class="retro-hook" transform="translate(260, 45)">
                            <path d="M0 -30 V10 C0 30 30 30 30 10 L 25 15" fill="none" stroke="var(--retro-white)"
                                stroke-width="6" />
                            <rect x="25" y="5" width="8" height="8" fill="var(--retro-yellow)" />
                        </g>

                        <g font-family="'Courier New', monospace" font-weight="bold" font-size="10"
                            transform="translate(40, 75)">
                            <text x="0" y="0" class="tagline-char" style="animation-delay: 8.0s"
                                fill="var(--retro-white)">H</text>
                            <text x="8" y="0" class="tagline-char" style="animation-delay: 8.1s"
                                fill="var(--retro-white)">O</text>
                            <text x="16" y="0" class="tagline-char" style="animation-delay: 8.2s"
                                fill="var(--retro-white)">O</text>
                            <text x="24" y="0" class="tagline-char" style="animation-delay: 8.3s"
                                fill="var(--retro-white)">K</text>
                            <text x="36" y="0" class="tagline-char" style="animation-delay: 8.5s"
                                fill="var(--retro-cyan)">L</text>
                            <text x="44" y="0" class="tagline-char" style="animation-delay: 8.6s"
                                fill="var(--retro-cyan)">I</text>
                            <text x="52" y="0" class="tagline-char" style="animation-delay: 8.7s"
                                fill="var(--retro-cyan)">N</text>
                            <text x="60" y="0" class="tagline-char" style="animation-delay: 8.8s"
                                fill="var(--retro-cyan)">E</text>
                            <text x="72" y="0" class="tagline-char" style="animation-delay: 9.0s"
                                fill="var(--retro-white)">C</text>
                            <text x="80" y="0" class="tagline-char" style="animation-delay: 9.1s"
                                fill="var(--retro-white)">O</text>
                            <text x="88" y="0" class="tagline-char" style="animation-delay: 9.2s"
                                fill="var(--retro-white)">N</text>
                            <text x="96" y="0" class="tagline-char" style="animation-delay: 9.3s"
                                fill="var(--retro-white)">N</text>
                            <text x="104" y="0" class="tagline-char" style="animation-delay: 9.4s"
                                fill="var(--retro-white)">E</text>
                            <text x="112" y="0" class="tagline-char" style="animation-delay: 9.5s"
                                fill="var(--retro-white)">C</text>
                            <text x="120" y="0" class="tagline-char" style="animation-delay: 9.6s"
                                fill="var(--retro-white)">T</text>
                        </g>
                    </svg>
                </div>
                {% if step == '2fa' %}
                <h4 class="mb-0 fw-bold accent-gradient">Two-Factor Auth</h4>
                {% else %}
                <h4 class="mb-0 fw-bold accent-gradient">Login to HookWise</h4>
                {% endif %}
            </div>

            <form method="POST" id="login-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

                {% if step == '2fa' %}
                <p class="text-secondary text-center mb-4">Enter the 6-digit code from your authenticator app.</p>
                <div class="mb-4">
                    <input type="text"
                        class="form-control form-control-lg text-center font-monospace ls-wide bg-dark bg-opacity-50 border-secondary text-light"
                        style="letter-spacing: 0.5em; font-size: 1.5rem;" id="otp" name="otp" placeholder="000000"
                        required autofocus autocomplete="one-time-code" maxlength="6">
                </div>
                <div class="d-grid mb-3">
                    <button type="submit" class="btn btn-primary btn-lg fw-bold shadow-lg" id="submit-btn">
                        <span class="btn-text">Verify Code</span>
                        <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    </button>
                </div>
                <div class="text-center">
                    <a href="{{ url_for('main.login') }}"
                        class="text-secondary small text-decoration-none hover-text-primary transition-colors">
                        &larr; Back to Login
                    </a>
                </div>
                {% else %}
                <div class="mb-3">
                    <label for="username" class="form-label small fw-bold text-secondary ls-wide">USERNAME</label>
                    <input type="text" class="form-control bg-dark bg-opacity-50 border-secondary text-light"
                        id="username" name="username" required autofocus placeholder="Enter your username">
                </div>
                <div class="mb-4">
                    <label for="password" class="form-label small fw-bold text-secondary ls-wide">PASSWORD</label>
                    <div class="input-group">
                        <input type="password"
                            class="form-control bg-dark bg-opacity-50 border-secondary text-light border-end-0"
                            id="password" name="password" required placeholder="Enter your password">
                        <button
                            class="btn btn-outline-secondary bg-dark bg-opacity-50 border-secondary border-start-0 text-secondary"
                            type="button" id="toggle-password">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-eye" viewBox="0 0 16 16" id="eye-icon">
                                <path
                                    d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z" />
                                <path
                                    d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-eye-slash d-none" viewBox="0 0 16 16" id="eye-slash-icon">
                                <path
                                    d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z" />
                                <path
                                    d="M11.297 9.32l.766.766a2.775 2.775 0 0 1-4.31.03l2.884-2.884a2.775 2.775 0 0 1 .66.766zm-4.296-4.296L8.258 6.65a2.775 2.775 0 0 1 4.52 4.52l3.65 3.65a.5.5 0 0 1-.708.708l-12-12a.5.5 0 0 1 .708 0l1.5 1.5z" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg fw-bold shadow-lg" id="submit-btn">
                        <span class="btn-text">Sign In</span>
                        <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    </button>
                </div>
                {% endif %}
            </form>
        </div>


    </div>
</div>

<script src="{{ url_for('static', filename='js/login-animation.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Password Toggle
        const toggleBtn = document.getElementById('toggle-password');
        const passwordInput = document.getElementById('password');
        const eyeIcon = document.getElementById('eye-icon');
        const eyeSlashIcon = document.getElementById('eye-slash-icon');

        if (toggleBtn) {
            toggleBtn.addEventListener('click', function () {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                eyeIcon.classList.toggle('d-none');
                eyeSlashIcon.classList.toggle('d-none');
            });
        }

        // Loading State
        const form = document.getElementById('login-form');
        const submitBtn = document.getElementById('submit-btn');

        if (form) {
            form.addEventListener('submit', function () {
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.querySelector('.btn-text').textContent = 'Signing In...';
                    submitBtn.querySelector('.spinner-border').classList.remove('d-none');
                }
            });
        }
    });
</script>
{% endblock %}